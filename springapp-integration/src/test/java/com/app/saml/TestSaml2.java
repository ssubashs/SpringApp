package com.app.saml;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.security.cert.CertificateException;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.stream.XMLStreamException;
import javax.xml.xpath.XPathExpressionException;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.opensaml.Configuration;
import org.opensaml.DefaultBootstrap;
import org.opensaml.saml2.core.Artifact;
import org.opensaml.saml2.core.impl.AuthnRequestImpl;
import org.opensaml.xml.ConfigurationException;
import org.opensaml.xml.XMLObject;
import org.opensaml.xml.io.Unmarshaller;
import org.opensaml.xml.io.UnmarshallerFactory;
import org.opensaml.xml.io.UnmarshallingException;
import org.opensaml.xml.util.Base64;
import org.springframework.security.saml.util.SAMLUtil;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.xml.sax.SAXException;

import com.saml.sso.AccountSettings;
import com.saml.sso.AppSettings;
import com.saml.sso.AuthRequest;
import com.saml.sso.Response;

public class TestSaml2 {
	AuthnRequestImpl impl;
	AppSettings samlSetting = new AppSettings();	
	AccountSettings accSetting = new AccountSettings();
	
	static
	{
		try {
			DefaultBootstrap.bootstrap();
		} catch (ConfigurationException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	};
	
	String encodedResponse = "PHNhbWxwOlJlc3BvbnNlIFZlcnNpb249IjIuMCIgSUQ9IklEMjcxZTVkOTEtMjQ2MS00ODE3LWI1M2UtMjdmNWY1ZjhhZWU2IiBJc3N1ZUluc3RhbnQ9IjIwMTUtMDEtMjZUMTk6NTY6MjRaIiBEZXN0aW5hdGlvbj0iIiB4bWxuczpjb209Imh0dHA6Ly9zY2hlbWFzLnp1cmljaC5jb20venNvYS9maWcvc2VjdXJpdHlwcm9jZXNzaW5nLzIwMDkvMDEvY29tbW9uIiB4bWxuczp6c29hPSJodHRwOi8vc2NoZW1hcy56dXJpY2guY29tL3pzb2EvZmlnL3NlY3VyaXR5cHJvY2Vzc2luZy8yMDA5LzAxL3pzb2EiIHhtbG5zOnNlYz0iaHR0cDovL3dlYnNlcnZpY2VzLnp1cmljaC5jb20venNvYS9maWcvc2VjdXJpdHlwcm9jZXNzaW5nL3NlY3VyaXR5dG9rZW5tYW5hZ2VyLXYxXzAiIHhtbG5zOnNvYXBlbnY9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3NvYXAvZW52ZWxvcGUvIiB4bWxuczpzaWduPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIiB4bWxuczpzYW1scD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PG5zMTpJc3N1ZXIgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHkiIHhtbG5zOm5zMT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+RmFybWVyczwvbnMxOklzc3Vlcj48c2FtbHA6U3RhdHVzPjxzYW1scDpTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz48L3NhbWxwOlN0YXR1cz48c2FtbDI6QXNzZXJ0aW9uIFZlcnNpb249IjIuMCIgSUQ9IlNBTUwtNzcyNjFiYzEtNGFlMi00MjJmLThlZjktYTc3Nzc5MWQ1YzU5IiBJc3N1ZUluc3RhbnQ9IjIwMTUtMDEtMjZUMTk6NTY6MjRaIj48c2FtbDI6SXNzdWVyPkZhcm1lcnM8L3NhbWwyOklzc3Vlcj48U2lnbmF0dXJlIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj4KPFNpZ25lZEluZm8+CiAgPENhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KICA8U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+CiAgPFJlZmVyZW5jZSBVUkk9IiNTQU1MLTc3MjYxYmMxLTRhZTItNDIyZi04ZWY5LWE3Nzc3OTFkNWM1OSI+CiAgICA8VHJhbnNmb3Jtcz4KICAgICAgPFRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+CiAgICAgIDxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KICAgIDwvVHJhbnNmb3Jtcz4KICAgIDxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPgogICAgPERpZ2VzdFZhbHVlPm5oeGF3ODg4Q0NBVG51RElITVNEbWpIVFNvOD08L0RpZ2VzdFZhbHVlPgogIDwvUmVmZXJlbmNlPgo8L1NpZ25lZEluZm8+CiAgICA8U2lnbmF0dXJlVmFsdWU+MlI0UmNvdkhKdjBsdGFTbFZBeTdlVHFYRkZ4RVdwMHRtUG9udHJHWVdmYmtzMUpNdGFzd2NiVFNHakJJMVdLUFMvUGpQWFNXM0xHdmxFN0dRdTBoU0NkeXVLR0pjL0wxZS80R08rYUM3cHlCc3VPQTNuUnkyNWJDMUlqSWFha1R5akx2c05mdU5OUHBqL3JsQWh5eFQrMEM1OXRac1IyMEFRZS92S21iUGRyQWo4ajg4bS9nWVY1eHNtVlBLSVg1RVVlekRVcktTN2huNVRWSzBKd0JBcE51QkhwUWEyd2xlUE81L3MvL1hjVTJvNmw4TFpiQTVDeFU1OTdDaTQzbFZFSnIvamkycm90eGpVOVRhMk52aUxnK3ZrWVlnY1BZQStnb0Nqbm04RStVeExnVERBRE93Y1N1ZUNWRkZxanNYSWFPSDU4MklmMStDZ1hmRDA4Y3dnPT08L1NpZ25hdHVyZVZhbHVlPjxLZXlJbmZvPjxYNTA5RGF0YT48WDUwOUNlcnRpZmljYXRlPk1JSUVXVENDQTBHZ0F3SUJBZ0lJUWRONitBQW94ekV3RFFZSktvWklodmNOQVFFRkJRQXdkekVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnVEFrTkJNUll3RkFZRFZRUUtFdzFHWVhKdFpYSnpJRWR5YjNWd01Sb3dHQVlEVlFRTEV4RkdZWEp0WlhKeklFbHVjM1Z5WVc1alpURW5NQ1VHQTFVRUF4TWVhRzB5YVdKa2NIRmhMbVpoY20xbGNuTnBibk4xY21GdVkyVXVZMjl0TUI0WERURXpNRFl5TVRJd05EVTBOMW9YRFRFMU1EWXlNVEl3TkRVME4xb3dkekVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnVEFrTkJNUll3RkFZRFZRUUtFdzFHWVhKdFpYSnpJRWR5YjNWd01Sb3dHQVlEVlFRTEV4RkdZWEp0WlhKeklFbHVjM1Z5WVc1alpURW5NQ1VHQTFVRUF4TWVhRzB5YVdKa2NIRmhMbVpoY20xbGNuTnBibk4xY21GdVkyVXVZMjl0TUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEzdXJaK1ZzZnErSk5IV1dxR2FxbHZJMXQyUzBtRG5uYkRackhZZSthVkxkdkQvK2pZb3M1VjNGM3VPcS8zblNUR1lIUTVKOGp0N2h4SXVFZGc4MENldUtNRk1GMXZSVTJDTVlISkFYRUdMK0Uxck5QckdWcFE3Z0lQQ3RoSGNQd0s2bURLa0Q1RWVjNW9xNkJ5T0dYeHFKREJJOHZ1ZHNlMTdsclp4b2RtOCtuVXR2TUw1UHFqZkpBN04rOW9EQVRXcEZTUjYzZXhYcEk0aENnaGg5ckluak1Cd1lGVldENmF6a0tCOEV2QUlKSVNGVzVDUXRjVnZtbHY1UlBjclJtOVdOMXExaSs0ZmZ3T0RRZXlNSHY5WkRKTjdGL0cxdFJBMzJDWFZXa1VPK280d3VjeWtZL0JTQ1VUR2V6RG50b0M0WHJkTlhJWXU2ZStvSjYxLzAzT1FJREFRQUJvNEhvTUlIbE1Bd0dBMVVkRXdRRk1BTUJBZjh3SFFZRFZSME9CQllFRk01SktBVFl4ZWM2RytiM1dGbDBCdDZkeXBDME1JR29CZ05WSFNNRWdhQXdnWjJBRk01SktBVFl4ZWM2RytiM1dGbDBCdDZkeXBDMG9YdWtlVEIzTVFzd0NRWURWUVFHRXdKVlV6RUxNQWtHQTFVRUNCTUNRMEV4RmpBVUJnTlZCQW9URFVaaGNtMWxjbk1nUjNKdmRYQXhHakFZQmdOVkJBc1RFVVpoY20xbGNuTWdTVzV6ZFhKaGJtTmxNU2N3SlFZRFZRUURFeDVvYlRKcFltUndjV0V1Wm1GeWJXVnljMmx1YzNWeVlXNWpaUzVqYjIyQ0NFSFRldmdBS01jeE1Bc0dBMVVkRHdRRUF3SUN2REFOQmdrcWhraUc5dzBCQVFVRkFBT0NBUUVBdGkvKzZiTEhaVnlEZEw2SGJ1MkpERUFvRUJidUZ1alNFY2ZOSFNKVGN1Z3hQak5qbnBPUms4dUdNN1kwRnJLNlpxRlhtTXFvREtERnFpWnFRRGNiM1lhbHI2d2FjRDFWYTlEcWZGblhoSFY0T1pkck5uZVpCWnRYdExLNGhxVmNKeThCKy9tanFjMEFlYlB4OWJVNHZ6SkV6WitwSGp0K1h1UlVHMkxkM3hTUHdkZnNTeS80OVlLVGdJTjhVNmY2L1RIa0ZuVHl2K1ZELzE4MUVFeWdOZHc3QUhIbU9MaHV2YmZnNGJGRGJlNFdSZXp3Tkc1aGxHSGtaN1ZDbVhhZG9xSTFaTVQxTTVKdlFuVkdGVUpUb01Vb0Y4K2dWTEluVjI1WFdXN3I3R2FDMWlLSWRvenkrMkR0OEdzc3BQUHcvT1VYNHpSbWxIWUl2T0RvMGZ6ejRBPT08L1g1MDlDZXJ0aWZpY2F0ZT48WDUwOUlzc3VlclNlcmlhbD48WDUwOUlzc3Vlck5hbWU+Q049aG0yaWJkcHFhLmZhcm1lcnNpbnN1cmFuY2UuY29tLCBPVT1GYXJtZXJzIEluc3VyYW5jZSwgTz1GYXJtZXJzIEdyb3VwLCBTVD1DQSwgQz1VUzwvWDUwOUlzc3Vlck5hbWU+PFg1MDlTZXJpYWxOdW1iZXI+NDc0MzI3MDAzODEyNDQxNDc2OTwvWDUwOVNlcmlhbE51bWJlcj48L1g1MDlJc3N1ZXJTZXJpYWw+PC9YNTA5RGF0YT48L0tleUluZm8+PC9TaWduYXR1cmU+PHNhbWwyOlN1YmplY3Q+PHNhbWwyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OnVuc3BlY2lmaWVkIj5yZW5uNTk5PC9zYW1sMjpOYW1lSUQ+PHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDI6U3ViamVjdENvbmZpcm1hdGlvbkRhdGEgTm90T25PckFmdGVyPSIyMDE1LTAxLTI3VDA1OjU2OjI5WiIgUmVjaXBpZW50PSJodHRwczovL2Vmbm9sLWZhcm1lcnMuY3MxNC5mb3JjZS5jb20vZWZub2wvbG9naW4/c289MDBEYzAwMDAwMDN0a2tKIi8+PC9zYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uPjwvc2FtbDI6U3ViamVjdD48c2FtbDI6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTUtMDEtMjZUMTk6NTY6MTlaIiBOb3RPbk9yQWZ0ZXI9IjIwMTUtMDEtMjdUMDU6NTY6MjlaIj48c2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDI6QXVkaWVuY2U+aHR0cHM6Ly9lZm5vbGRldnRlc3QuZm9yY2UuY29tPC9zYW1sMjpBdWRpZW5jZT48L3NhbWwyOkF1ZGllbmNlUmVzdHJpY3Rpb24+PHNhbWwyOkF1ZGllbmNlUmVzdHJpY3Rpb24+PHNhbWwyOkF1ZGllbmNlPmh0dHBzOi8vZWZub2wtZmFybWVycy5jczE0LmZvcmNlLmNvbS9lZm5vbC9sb2dpbj9zbz0wMERjMDAwMDAwM3Rra0o8L3NhbWwyOkF1ZGllbmNlPjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj48L3NhbWwyOkNvbmRpdGlvbnM+PHNhbWwyOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAxNS0wMS0yNlQxOTo1NjoyNFoiIFNlc3Npb25Ob3RPbk9yQWZ0ZXI9IjIwMTUtMDEtMjdUMDU6NTY6MjlaIj48c2FtbDI6U3ViamVjdExvY2FsaXR5IEFkZHJlc3M9IjEwLjE0MS4yNTQuODciLz48c2FtbDI6QXV0aG5Db250ZXh0PjxzYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3Nlczp1bnNwZWNpZmllZDwvc2FtbDI6QXV0aG5Db250ZXh0Q2xhc3NSZWY+PC9zYW1sMjpBdXRobkNvbnRleHQ+PC9zYW1sMjpBdXRoblN0YXRlbWVudD48c2FtbDI6QXR0cmlidXRlU3RhdGVtZW50PjxzYW1sMjpBdHRyaWJ1dGUgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCIgTmFtZT0iRmlyc3RfTmFtZSI+PHNhbWwyOkF0dHJpYnV0ZVZhbHVlPlJveTwvc2FtbDI6QXR0cmlidXRlVmFsdWU+PC9zYW1sMjpBdHRyaWJ1dGU+PHNhbWwyOkF0dHJpYnV0ZSBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIiBOYW1lPSJMYXN0X05hbWUiPjxzYW1sMjpBdHRyaWJ1dGVWYWx1ZT5Sb2dlcnM8L3NhbWwyOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDI6QXR0cmlidXRlPjxzYW1sMjpBdHRyaWJ1dGUgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCIgTmFtZT0iQU9SIj48c2FtbDI6QXR0cmlidXRlVmFsdWU+ODgwMjA5PC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT48L3NhbWwyOkF0dHJpYnV0ZT48c2FtbDI6QXR0cmlidXRlIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiIE5hbWU9IkVtYWlsIj48c2FtbDI6QXR0cmlidXRlVmFsdWU+cnJvZ2Vyc0BmYXJtZXJzYWdlbnQuY29tPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT48L3NhbWwyOkF0dHJpYnV0ZT48c2FtbDI6QXR0cmlidXRlIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiIE5hbWU9IlVzZXJJRCI+PHNhbWwyOkF0dHJpYnV0ZVZhbHVlPnJlbm41OTk8L3NhbWwyOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDI6QXR0cmlidXRlPjxzYW1sMjpBdHRyaWJ1dGUgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCIgTmFtZT0iUm9sZSI+PHNhbWwyOkF0dHJpYnV0ZVZhbHVlPkFnZW50PC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT48L3NhbWwyOkF0dHJpYnV0ZT48L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD48L3NhbWwyOkFzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPg==";
	//String encodedResponse = "PFJlc3BvbnNlIHhtbG5zPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIERlc3RpbmF0aW9uPSJodHRwczovL2NvbmZpZ2Rldi1mYXJtZXJzLmNzNy5mb3JjZS5jb20vc2VsZnNlcnZpY2ViaWxsaW5nL2xvZ2luP3NvPTAwRE0wMDAwMDAxNENVTCIgSUQ9Il9lOTI0ZjNhNTdlODM1ZGUxODEyZDg1YzA4MmI1ZTI4Yzg1MTgiIElzc3VlSW5zdGFudD0iMjAxNS0wMS0yMFQyMDozMDozOFoiIFZlcnNpb249IjIuMCI+CiAgICA8bnMxOklzc3VlciB4bWxuczpuczE9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5DU1NUQi1UTy1TQUxFU0ZPUkNFPC9uczE6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPgo8ZHM6U2lnbmVkSW5mbz4KPGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KPGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPgo8ZHM6UmVmZXJlbmNlIFVSST0iI19lOTI0ZjNhNTdlODM1ZGUxODEyZDg1YzA4MmI1ZTI4Yzg1MTgiPgo8ZHM6VHJhbnNmb3Jtcz4KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+CjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KPC9kczpUcmFuc2Zvcm1zPgo8ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz4KPGRzOkRpZ2VzdFZhbHVlPk02TjB2YWVuNjJSRS9yTHhYeGhUbVZ6eEg4OD08L2RzOkRpZ2VzdFZhbHVlPgo8L2RzOlJlZmVyZW5jZT4KPC9kczpTaWduZWRJbmZvPgo8ZHM6U2lnbmF0dXJlVmFsdWU+CmdTOXBGOVYxQjYvRkp3NHpsRUNqZTc5NTVDOG4xdUswYUNHVEE5NkcvaE9YZnErK3JGZmxtRjE2TTFFRVUyZU9RV2J5Q1BHb2RCdG8KRGZqbUJJZHdZVFdtR0o4TjRPNERTcGl5K2E0NDZycTE2MmJaTUxoeGsxRDQ4M2lob0NoRVhpOUNHc29tVTQ0cHgwM2ZvWWwrWGEwNgpHYTBiTnhYNGF3dWFEWTdMN0h5RzlFSHVJb2s1WFNOSTVlSGNlSGdpZGUwand1cll2aW5JS3BtMDl4TytLVzBXeTJIOExOd2YzakMrCklKYWNpMExhWEdldGFWSnpkeW0vNUJUTnlBbzZOMmZNR0duUkhVY1VWZGYzN1pFMWpJWGROZnlLaFJ4dnZKc09halYzc3NzMTNJeEMKZGFCandZTGtvL0JPMjRzcXh1UHRQb01zWnZjQ3Q5dGh1eEJaV0E9PQo8L2RzOlNpZ25hdHVyZVZhbHVlPgo8ZHM6S2V5SW5mbz4KPGRzOlg1MDlEYXRhPgo8ZHM6WDUwOUNlcnRpZmljYXRlPgpNSUlFUERDQ0F5U2dBd0lCQWdJT0FnQUFBQUFCUUhsVk9YUjliSkl3RFFZSktvWklodmNOQVFFRkJRQXdSakVYTUJVR0ExVUVDaE1PClEzbGlaWEowY25WemRDQkpibU14S3pBcEJnTlZCQU1USWtONVltVnlkSEoxYzNRZ1VIVmliR2xqSUZOMWNtVlRaWEoyWlhJZ1UxWWcKUTBFd0hoY05NVE13T0RFek1qQXlPVEV4V2hjTk1UVXdPREV6TWpBeU9URXhXakIrTVFzd0NRWURWUVFHRXdKVlV6RVRNQkVHQTFVRQpDQk1LUTJGc2FXWnZjbTVwWVRFVU1CSUdBMVVFQnhNTFRHOXpJRUZ1WjJWc1pYTXhHekFaQmdOVkJBb1RFa1poY20xbGNuTWdSM0p2CmRYQWdTVzVqTGpFTE1Ba0dBMVVFQ3hNQ1NWUXhHakFZQmdOVkJBTVRFV056YzNSeExtWmhjbTFsY25NdVkyOXRNSUlCSWpBTkJna3EKaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFvdmp0T3NJamFsODg3bDBTYk9nWjBzS3FVTU5aT2dSYWJXT2ZqVWtlWnNiWQpkcTY5VFI5dnRYZW9HUEtHSnBMbWtHS21XT3ZDODc3SVhpOFNwdGNFWDVtSDQ1aXpyQmYvR2JZK2lETVkzTHNyeUM0b3dCOEExaE1OCmFzU212aHJadUoxa05pK1h6SzNkTkYxbXUxWEV1Y0tiZ2g2SnhoRVYzaVEzUVcyNHZxOEsvOS8wUWNEdHk3a3lUNTd3WlNQTXgxSW4KUU1neW0zWWJlMEdpbjkvYXlja1FmMHFxNDQrUjJxVkJybXZlZmhuNUo3V2hBZVluaWNxNEoyM1pONURTRXQrbys5UFdLeDljSTBhegorTitJcTI2Qyt1UDBIYVhvcGI1R242RG54UzRqbEdMeStMeEdQUkM3cVg3c0tJNHJUbnMrMWZqY2lqNUtaR1U4c1hrUFp3SURBUUFCCm80SHZNSUhzTUI4R0ExVWRJd1FZTUJhQUZBU1lZTitBRzVaSlhXVldMYVVzQ1NRSzdOeTVNRDhHQTFVZEh3UTRNRFl3TktBeW9EQ0cKTG1oMGRIQTZMeTlqY213dWIyMXVhWEp2YjNRdVkyOXRMMUIxWW14cFkxTjFjbVZUWlhKMlpYSlRWaTVqY213d0hRWURWUjBPQkJZRQpGR1BUL1ZSKy9pWlZhOUE5L0JsakdQYlJUNXZxTUFrR0ExVWRFd1FDTUFBd0RnWURWUjBQQVFIL0JBUURBZ1dnTUIwR0ExVWRKUVFXCk1CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFSQmdsZ2hrZ0JodmhDQVFFRUJBTUNCc0F3SEFZRFZSMFJCQlV3RTRJUlkzTnoKZEhFdVptRnliV1Z5Y3k1amIyMHdEUVlKS29aSWh2Y05BUUVGQlFBRGdnRUJBRUd1QWdhWXpnRXYrbEl3UDdzZ2E4QzFkNzFoS3d5cAp1WVB0a2M4ZzVNaTJQbHJEbnJWc3VKU0VmS0JjallZNzRwN1ZFOUh4OEhwbW1CeVBCSlVxL3FrcStuWTNmbVRocnhOYUZCMFVXbk9SCnhnVG91dmxCS3BWY0xHcDEwVHp6OW5mVHNLWDYyOE1HUXNuVEFGT0Nkd2NHcUQwelRXc2xWM044NGpIWWpINnJ3TGtaS2dJZVM4V3IKUndSMCtBSFB5Y2VsZnROVjR0WEJvcS9LUUVCVnJ0SXlIM2FESWIwUStWeE9QbTFubTl5a3dJVTdUd3huYnlmYjd4SVZUaG1ZbnlnSQpVVS9lb0hQNnl5Z1A4bnlSdkpGbCttUExrU1puejNPeGZnejZtY29oY2xhSitBbzA0SjVTRmpOQjZDZzFOTlk1WjBnUlFYWXRIdFpNCisrV3V4b0U9CjwvZHM6WDUwOUNlcnRpZmljYXRlPgo8L2RzOlg1MDlEYXRhPgo8L2RzOktleUluZm8+CjwvZHM6U2lnbmF0dXJlPgogICAgPFN0YXR1cz4KICAgICAgICA8U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+CiAgICA8L1N0YXR1cz4KICAgIDxuczI6QXNzZXJ0aW9uIHhtbG5zOm5zMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9Il84MzhmMTM2YzNlNWEzMjc3ZWY3NzRiZWI3YjgyYTIzYTNlMDAiIElzc3VlSW5zdGFudD0iMjAxNS0wMS0yMFQyMDozMDozOFoiIFZlcnNpb249IjIuMCI+CiAgICAgICAgPG5zMjpJc3N1ZXIgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHkiPkNTU1RCLVRPLVNBTEVTRk9SQ0U8L25zMjpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+CjxkczpTaWduZWRJbmZvPgo8ZHM6Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPgo8ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+CjxkczpSZWZlcmVuY2UgVVJJPSIjXzgzOGYxMzZjM2U1YTMyNzdlZjc3NGJlYjdiODJhMjNhM2UwMCI+CjxkczpUcmFuc2Zvcm1zPgo8ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz4KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPgo8L2RzOlRyYW5zZm9ybXM+CjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPgo8ZHM6RGlnZXN0VmFsdWU+ZFpYWVhJK2ZjKzdScU5CaC9Kb2ttcXRac0U4PTwvZHM6RGlnZXN0VmFsdWU+CjwvZHM6UmVmZXJlbmNlPgo8L2RzOlNpZ25lZEluZm8+CjxkczpTaWduYXR1cmVWYWx1ZT4KSUZIZXdPWjgvSzl4YURoYStmOEVVK1hvZWs1ODJYbktQV3RTenhHUE54YkNOTzBEZGtYd0o5OUYvUVB0bDBpNmU4SjUzWkN5M2x2ZQp5RkNnZElaMUVZYkRKSzc0dXRrRDNDbHlBUVl4cmhJRlJrL2xDWXBtT3VJcExIb1V4UHZiNjFkSXBOdEg1bVkraHp0YUpxL1RrZjg1CnU2NGJ0M1RKV0trcjkwWTFha28wakluNGY5K3VFSXpFK29jMzJyY1ZmbEMveFFYVkxqY25sU1p6WWM5M2xKUkE2RnNVZnI4RXVQbjEKOU5yMTdEc0pDblk5SzVkMHc5VzlmQmlQNnVEZldYdHlac3lZdGI3NXZLYUROb2hxUzhUcnJ5c1VQZ1lWaWVBK3RhV0tVL0pDZm5URQpYYlhJZmpEM295bmg2MWZiNGNsaVBlVFd3bUp1Rkt5SXBhWUExdz09CjwvZHM6U2lnbmF0dXJlVmFsdWU+CjxkczpLZXlJbmZvPgo8ZHM6WDUwOURhdGE+CjxkczpYNTA5Q2VydGlmaWNhdGU+Ck1JSUVQRENDQXlTZ0F3SUJBZ0lPQWdBQUFBQUJRSGxWT1hSOWJKSXdEUVlKS29aSWh2Y05BUUVGQlFBd1JqRVhNQlVHQTFVRUNoTU8KUTNsaVpYSjBjblZ6ZENCSmJtTXhLekFwQmdOVkJBTVRJa041WW1WeWRISjFjM1FnVUhWaWJHbGpJRk4xY21WVFpYSjJaWElnVTFZZwpRMEV3SGhjTk1UTXdPREV6TWpBeU9URXhXaGNOTVRVd09ERXpNakF5T1RFeFdqQitNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFCkNCTUtRMkZzYVdadmNtNXBZVEVVTUJJR0ExVUVCeE1MVEc5eklFRnVaMlZzWlhNeEd6QVpCZ05WQkFvVEVrWmhjbTFsY25NZ1IzSnYKZFhBZ1NXNWpMakVMTUFrR0ExVUVDeE1DU1ZReEdqQVlCZ05WQkFNVEVXTnpjM1J4TG1aaGNtMWxjbk11WTI5dE1JSUJJakFOQmdrcQpoa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQW92anRPc0lqYWw4ODdsMFNiT2daMHNLcVVNTlpPZ1JhYldPZmpVa2Vac2JZCmRxNjlUUjl2dFhlb0dQS0dKcExta0dLbVdPdkM4NzdJWGk4U3B0Y0VYNW1INDVpenJCZi9HYlkraURNWTNMc3J5QzRvd0I4QTFoTU4KYXNTbXZoclp1SjFrTmkrWHpLM2RORjFtdTFYRXVjS2JnaDZKeGhFVjNpUTNRVzI0dnE4Sy85LzBRY0R0eTdreVQ1N3daU1BNeDFJbgpRTWd5bTNZYmUwR2luOS9heWNrUWYwcXE0NCtSMnFWQnJtdmVmaG41SjdXaEFlWW5pY3E0SjIzWk41RFNFdCtvKzlQV0t4OWNJMGF6CitOK0lxMjZDK3VQMEhhWG9wYjVHbjZEbnhTNGpsR0x5K0x4R1BSQzdxWDdzS0k0clRucysxZmpjaWo1S1pHVThzWGtQWndJREFRQUIKbzRIdk1JSHNNQjhHQTFVZEl3UVlNQmFBRkFTWVlOK0FHNVpKWFdWV0xhVXNDU1FLN055NU1EOEdBMVVkSHdRNE1EWXdOS0F5b0RDRwpMbWgwZEhBNkx5OWpjbXd1YjIxdWFYSnZiM1F1WTI5dEwxQjFZbXhwWTFOMWNtVlRaWEoyWlhKVFZpNWpjbXd3SFFZRFZSME9CQllFCkZHUFQvVlIrL2laVmE5QTkvQmxqR1BiUlQ1dnFNQWtHQTFVZEV3UUNNQUF3RGdZRFZSMFBBUUgvQkFRREFnV2dNQjBHQTFVZEpRUVcKTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGQlFjREFqQVJCZ2xnaGtnQmh2aENBUUVFQkFNQ0JzQXdIQVlEVlIwUkJCVXdFNElSWTNOegpkSEV1Wm1GeWJXVnljeTVqYjIwd0RRWUpLb1pJaHZjTkFRRUZCUUFEZ2dFQkFFR3VBZ2FZemdFditsSXdQN3NnYThDMWQ3MWhLd3lwCnVZUHRrYzhnNU1pMlBsckRuclZzdUpTRWZLQmNqWVk3NHA3VkU5SHg4SHBtbUJ5UEJKVXEvcWtxK25ZM2ZtVGhyeE5hRkIwVVduT1IKeGdUb3V2bEJLcFZjTEdwMTBUeno5bmZUc0tYNjI4TUdRc25UQUZPQ2R3Y0dxRDB6VFdzbFYzTjg0akhZakg2cndMa1pLZ0llUzhXcgpSd1IwK0FIUHljZWxmdE5WNHRYQm9xL0tRRUJWcnRJeUgzYURJYjBRK1Z4T1BtMW5tOXlrd0lVN1R3eG5ieWZiN3hJVlRobVlueWdJClVVL2VvSFA2eXlnUDhueVJ2SkZsK21QTGtTWm56M094Zmd6Nm1jb2hjbGFKK0FvMDRKNVNGak5CNkNnMU5OWTVaMGdSUVhZdEh0Wk0KKytXdXhvRT0KPC9kczpYNTA5Q2VydGlmaWNhdGU+CjwvZHM6WDUwOURhdGE+CjwvZHM6S2V5SW5mbz4KPC9kczpTaWduYXR1cmU+CiAgICAgICAgPG5zMjpTdWJqZWN0PgogICAgICAgICAgICA8bnMyOk5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OnVuc3BlY2lmaWVkIj5yb2d5eTEyMzwvbnMyOk5hbWVJRD4KICAgICAgICAgICAgPG5zMjpTdWJqZWN0Q29uZmlybWF0aW9uIE1ldGhvZD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNtOmJlYXJlciI+CiAgICAgICAgICAgICAgICA8bnMyOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAxNS0wMS0yMFQyMDozMjowOFoiIFJlY2lwaWVudD0iaHR0cHM6Ly9jb25maWdkZXYtZmFybWVycy5jczcuZm9yY2UuY29tL3NlbGZzZXJ2aWNlYmlsbGluZy9sb2dpbj9zbz0wMERNMDAwMDAwMTRDVUwiLz4KICAgICAgICAgICAgPC9uczI6U3ViamVjdENvbmZpcm1hdGlvbj4KICAgICAgICA8L25zMjpTdWJqZWN0PgogICAgICAgIDxuczI6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTUtMDEtMjBUMjA6MzA6MDhaIiBOb3RPbk9yQWZ0ZXI9IjIwMTUtMDEtMjBUMjA6MzI6MDhaIj4KICAgICAgICAgICAgPG5zMjpBdWRpZW5jZVJlc3RyaWN0aW9uPgogICAgICAgICAgICAgICAgPG5zMjpBdWRpZW5jZT5odHRwczovL2NvbmZpZ2Rldi1zYW1sLmZhcm1lcnMuZm9yY2UuY29tLzwvbnMyOkF1ZGllbmNlPgogICAgICAgICAgICA8L25zMjpBdWRpZW5jZVJlc3RyaWN0aW9uPgogICAgICAgICAgICA8bnMyOkF1ZGllbmNlUmVzdHJpY3Rpb24+CiAgICAgICAgICAgICAgICA8bnMyOkF1ZGllbmNlPmh0dHBzOi8vY29uZmlnZGV2LWZhcm1lcnMuY3M3LmZvcmNlLmNvbS9zZWxmc2VydmljZWJpbGxpbmcvbG9naW4/c289MDBETTAwMDAwMDE0Q1VMPC9uczI6QXVkaWVuY2U+CiAgICAgICAgICAgIDwvbnMyOkF1ZGllbmNlUmVzdHJpY3Rpb24+CiAgICAgICAgPC9uczI6Q29uZGl0aW9ucz4KICAgICAgICA8bnMyOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAxNS0wMS0yMFQyMDoyODoxOVoiIFNlc3Npb25JbmRleD0iNFNab1VPNEFjcHFiOWIvMXRIZzI5dG1OQ3NrPUVxRWN5QT09IiBTZXNzaW9uTm90T25PckFmdGVyPSIyMDE1LTAxLTIwVDIwOjMyOjA4WiI+CiAgICAgICAgICAgIDxuczI6QXV0aG5Db250ZXh0PgogICAgICAgICAgICAgICAgPG5zMjpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZDwvbnMyOkF1dGhuQ29udGV4dENsYXNzUmVmPgogICAgICAgICAgICA8L25zMjpBdXRobkNvbnRleHQ+CiAgICAgICAgPC9uczI6QXV0aG5TdGF0ZW1lbnQ+CiAgICAgICAgPG5zMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgICAgIDxuczI6QXR0cmlidXRlIE5hbWU9IlVzZXIuRmlyc3ROYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIj4KICAgICAgICAgICAgICAgIDxuczI6QXR0cmlidXRlVmFsdWU+Uk9HRVIgICAgICAgICAgPC9uczI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgICAgIDwvbnMyOkF0dHJpYnV0ZT4KICAgICAgICAgICAgPG5zMjpBdHRyaWJ1dGUgTmFtZT0iVXNlci5MYXN0TmFtZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+CiAgICAgICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZVZhbHVlPmVpY2ttYW48L25zMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICAgICAgPC9uczI6QXR0cmlidXRlPgogICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZSBOYW1lPSJVc2VyLlVzZXJuYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIj4KICAgICAgICAgICAgICAgIDxuczI6QXR0cmlidXRlVmFsdWU+cm9neXkxMjM8L25zMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICAgICAgPC9uczI6QXR0cmlidXRlPgogICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZSBOYW1lPSJVc2VyLkVtYWlsIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIj4KICAgICAgICAgICAgICAgIDxuczI6QXR0cmlidXRlVmFsdWU+cm9neXkxMjNAZmFybS5jb208L25zMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICAgICAgPC9uczI6QXR0cmlidXRlPgogICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZSBOYW1lPSJVc2VyLkxvY2FsZVNpZEtleSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+CiAgICAgICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZVZhbHVlPmVuX1VTPC9uczI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgICAgIDwvbnMyOkF0dHJpYnV0ZT4KICAgICAgICAgICAgPG5zMjpBdHRyaWJ1dGUgTmFtZT0iVXNlci5UaW1lWm9uZVNpZEtleSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+CiAgICAgICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZVZhbHVlPkFtZXJpY2EvTG9zX0FuZ2VsZXM8L25zMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICAgICAgPC9uczI6QXR0cmlidXRlPgogICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZSBOYW1lPSJVc2VyLkVtYWlsRW5jb2RpbmdLZXkiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPgogICAgICAgICAgICAgICAgPG5zMjpBdHRyaWJ1dGVWYWx1ZT5JU08tODg1OS0xPC9uczI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgICAgIDwvbnMyOkF0dHJpYnV0ZT4KICAgICAgICAgICAgPG5zMjpBdHRyaWJ1dGUgTmFtZT0iVXNlci5MYW5ndWFnZUxvY2FsZUtleSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+CiAgICAgICAgICAgICAgICA8bnMyOkF0dHJpYnV0ZVZhbHVlPmVuX1VTPC9uczI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgICAgIDwvbnMyOkF0dHJpYnV0ZT4KICAgICAgICAgICAgPG5zMjpBdHRyaWJ1dGUgTmFtZT0iVXNlci5Qcm9maWxlX05hbWVfX2MiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPgogICAgICAgICAgICAgICAgPG5zMjpBdHRyaWJ1dGVWYWx1ZT5DdXN0b21lciBDb21tdW5pdHkgTG9naW4gVXNlcjwvbnMyOkF0dHJpYnV0ZVZhbHVlPgogICAgICAgICAgICA8L25zMjpBdHRyaWJ1dGU+CiAgICAgICAgPG5zMjpBdHRyaWJ1dGUgTmFtZT0iVXNlci5GZWRlcmF0aW9uSWRlbnRpZmllciIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PG5zMjpBdHRyaWJ1dGVWYWx1ZT51aWQ9cm9neXkxMjMsT1U9Q1NTLE9VPUN1c3RvbWVycyxPVT1QZW9wbGUsREM9RmFybWVycyxEQz1DT008L25zMjpBdHRyaWJ1dGVWYWx1ZT48L25zMjpBdHRyaWJ1dGU+PC9uczI6QXR0cmlidXRlU3RhdGVtZW50PgogICAgPC9uczI6QXNzZXJ0aW9uPgo8L1Jlc3BvbnNlPg==";
	
	@Before
	public void init()
	{
		
		URL url = this.getClass().getResource("/saml/hm2ibdpqa.farmersinsurance.com-sscert.cer");
		File certFile = new File(url.getFile());
		samlSetting.setAssertionConsumerServiceUrl("https://efnol-farmers.cs14.force.com/efnol/login?so=00Dc0000003tkkJ");
		samlSetting.setIssuer("https://efnoldevtest.force.com");		
		accSetting.setIdpSsoTargetUrl("http://localhost:9081/AdeWeb/ade?req_page=saml2");
		accSetting.setCertificatePath("/saml/hm2ibdpqa.farmersinsurance.com-sscert.cer");
		
		
	}
	
	@Test
	public void testSaml2Request()
	{
		
		AuthRequest samlRequest = new AuthRequest(samlSetting, accSetting);
		try {
			System.out.println(samlRequest.getRequest(AuthRequest.base64));
		} catch (XMLStreamException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
//		BasicSAMLMessageContext<SAMLObject, SAMLObject, SAMLObject> context = 
		
		/*
			HttpServletResponseAdapter responseAdapter = new HttpServletResponseAdapter(response, true);
			  BasicSAMLMessageContext<SAMLObject, AuthnRequest, SAMLObject> context = new BasicSAMLMessageContext<SAMLObject, AuthnRequest, SAMLObject>();  
			  context.setPeerEntityEndpoint();
			  context.setOutboundSAMLMessage(samlRequest);
			  context.setOutboundSAMLMessageSigningCredential(getSigningCredential());
			  context.setOutboundMessageTransport(responseAdapter);
			  
			  HTTPRedirectDeflateEncoder encoder = new HTTPRedirectDeflateEncoder();
			 
			  try {
			   encoder.encode(context);
			  } catch (MessageEncodingException e) {
			   logger.error(e.getMessage(), e);
			  }
			 }
		*/		
		

	}
	
	@Test
	public void testSaml2Response()
	{
		//URL url = this.getClass().getResource("/saml/samlresponse.xml");
		//File testxml = new File(url.getFile());
		
		
		 
		Response samlResponse;
		try {
			samlResponse = new Response(accSetting);
			 samlResponse.loadXmlFromBase64(encodedResponse);
//			  samlResponse.setDestinationUrl("https://configdev-farmers.cs7.force.com/selfservicebilling/login?so=00DM00000014CUL");
			 samlResponse.setDestinationUrl("https://efnol-farmers.cs14.force.com/efnol/login?so=00Dc0000003tkkJ");
			 
			 if(samlResponse.isValid())
				 System.out.println("valid request");
			 else
				 System.out.println("invalid request");
		} catch (CertificateException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (XPathExpressionException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (ParserConfigurationException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SAXException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		 
		
	}
	
	
	@Test
	public void saml2Unmarshall()
	{
		byte[] base64DecodedResponse = Base64.decode(encodedResponse);
		ByteArrayInputStream is = new ByteArrayInputStream(base64DecodedResponse);

		DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
		documentBuilderFactory.setNamespaceAware(true);
		DocumentBuilder docBuilder = null;
		org.opensaml.saml2.core.Response response = null;
		try {
			docBuilder = documentBuilderFactory.newDocumentBuilder();
			Document document = docBuilder.parse(is);
			Element element = document.getDocumentElement();
			UnmarshallerFactory unmarshallerFactory = Configuration.getUnmarshallerFactory();
			Unmarshaller unmarshaller = unmarshallerFactory.getUnmarshaller(element);
			XMLObject responseXmlObj = unmarshaller.unmarshall(element);
			response =  (org.opensaml.saml2.core.Response) responseXmlObj;
			
		} catch (ParserConfigurationException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SAXException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (UnmarshallingException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
			
			Assert.assertNotNull(response);

		
	}
	
	
	public void testSamlUtils()
	{
//	OpenSAMLUtils.buildSAMLObject(Artifact.class);
		
    
	}

}
